<!DOCTYPE html>
<html lang="vi" spellcheck="false">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Admin Dashboard - Quản trị hệ thống</title>
        
        <!-- External CSS -->
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" />
        <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css" rel="stylesheet" />
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="css/admin-dashboard.css" />

        <!-- JavaScript -->
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
        />
        <meta name="theme-color" content="#ffffff" />
        <meta name="mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta
            name="apple-mobile-web-app-status-bar-style"
            content="black-translucent"
        />
        <meta
            http-equiv="Content-Security-Policy"
            content="
            default-src 'self' http://localhost:* http://127.0.0.1:*;
            script-src 'self' 'unsafe-inline' 'unsafe-eval' https://code.jquery.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;
            style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com;
            img-src 'self' data: https://unpkg.com;
            font-src 'self' https://fonts.gstatic.com https://cdnjs.cloudflare.com;
            connect-src 'self' http://localhost:* http://127.0.0.1:* https://cdn.jsdelivr.net ws://localhost:8080 ws://127.0.0.1:8080;
            worker-src 'self' blob:;
            frame-src 'self';
            object-src 'none';"
        />
        <title>Admin Dashboard - Quản trị hệ thống</title>
        <link rel="stylesheet" href="css/admin-dashboard.css" />
        <script src="js/menu-handler.js"></script>
        <script src="js/dashboard.js"></script>
        <script src="test-storage.js"></script>

        <!-- External CSS -->
        <link
            rel="stylesheet"
            href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
        />
        <link rel="stylesheet" href="css/ui_utils.css" />
        <link
            href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/css/bootstrap.min.css"
            rel="stylesheet"
        />
        <link
            href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
            rel="stylesheet"
        />
        <link rel="stylesheet" href="css/admin-dashboard.css" />

        <!-- JavaScript -->
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.2/js/bootstrap.bundle.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
        <script
            type="module"
            src="assets/js/main.js"
        ></script>

        <!-- Main Dashboard Scripts -->
        <script type="module">
            // Common utilities
            const CommonUtils = {
                formatDate: (date) => {
                    return new Date(date).toLocaleDateString("vi-VN");
                },
                formatCurrency: (amount) => {
                    return new Intl.NumberFormat("vi-VN", {
                        style: "currency",
                        currency: "VND",
                    }).format(amount);
                },
            };

            // Authentication utilities
            const AuthUtils = {
                isAuthenticated: () => {
                    return true; // Always return true to bypass authentication
                },
                logout: () => {
                    window.location.href = "/login_new.html";
                },
            };

            // Permission utilities
            const PermissionUtils = {
                hasPermission: (permission) => {
                    return true; // Always return true to bypass permission checks
                },
            };

            // Notification utilities
            const NotificationUtils = {
                show: (message, type = "info") => {
                    const container = document.getElementById(
                        "notificationContainer"
                    );
                    const notification = document.createElement("div");
                    notification.className = `notification ${type}`;
                    notification.textContent = message;
                    container.appendChild(notification);
                    setTimeout(() => notification.remove(), 5000);
                },
            };

            // UI utilities
            const UIUtils = {
                toggleDarkMode: () => {
                    document.body.classList.toggle("dark-mode");
                    localStorage.setItem(
                        "darkMode",
                        document.body.classList.contains("dark-mode")
                    );
                },
                toggleSidebar: () => {
                    document
                        .querySelector(".sidebar")
                        .classList.toggle("collapsed");
                },
            };

            // API utilities
            const APIUtils = {
                baseUrl: 'http://localhost/qlnhansu_V2/backend/src/public/api',
                maxRetries: 3,
                retryDelay: 1000,
                cache: new Map(),
                cacheTimeout: 5 * 60 * 1000, // 5 minutes

                // Authentication handling
                getAuthHeaders() {
                    const token = localStorage.getItem('token');
                    return {
                        'Authorization': `Bearer ${token}`,
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    };
                },

                // Enhanced error handling
                handleError(error, endpoint) {
                    const errorTypes = {
                        'NetworkError': 'Lỗi kết nối mạng',
                        'SyntaxError': 'Lỗi định dạng dữ liệu',
                        'TypeError': 'Lỗi xử lý dữ liệu',
                        'default': 'Lỗi không xác định'
                    };

                    const errorMessage = errorTypes[error.name] || errorTypes.default;
                    console.error(`Error in ${endpoint}:`, error);
                    NotificationUtils.show(`${errorMessage}: ${error.message}`, 'error');
                },

                // Cache management
                setCache(key, data) {
                    this.cache.set(key, {
                        data,
                        timestamp: Date.now()
                    });
                },

                getCache(key) {
                    const cached = this.cache.get(key);
                    if (cached && Date.now() - cached.timestamp < this.cacheTimeout) {
                        return cached.data;
                    }
                    this.cache.delete(key);
                    return null;
                },

                // Enhanced fetch with retry and error handling
                async fetchWithRetry(endpoint, options = {}, retryCount = 0) {
                    try {
                        const response = await fetch(`${this.baseUrl}/${endpoint}`, {
                            ...options,
                            headers: {
                                ...this.getAuthHeaders(),
                                ...options.headers
                            },
                            credentials: 'include'
                        });

                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }

                        const data = await response.json();
                        return data;
                    } catch (error) {
                        if (retryCount < this.maxRetries) {
                            await new Promise(resolve => setTimeout(resolve, this.retryDelay * (retryCount + 1)));
                            return this.fetchWithRetry(endpoint, options, retryCount + 1);
                        }
                        this.handleError(error, endpoint);
                        return null;
                    }
                },

                // GET request with caching
                async get(endpoint, options = {}) {
                    const cacheKey = `GET:${endpoint}:${JSON.stringify(options)}`;
                    const cachedData = this.getCache(cacheKey);
                    if (cachedData) {
                        return cachedData;
                    }

                    const data = await this.fetchWithRetry(endpoint, {
                        method: 'GET',
                        ...options
                    });

                    if (data) {
                        this.setCache(cacheKey, data);
                    }
                    return data;
                },

                // POST request
                async post(endpoint, body, options = {}) {
                    return this.fetchWithRetry(endpoint, {
                        method: 'POST',
                        body: JSON.stringify(body),
                        ...options
                    });
                },

                // PUT request
                async put(endpoint, body, options = {}) {
                    return this.fetchWithRetry(endpoint, {
                        method: 'PUT',
                        body: JSON.stringify(body),
                        ...options
                    });
                },

                // DELETE request
                async delete(endpoint, options = {}) {
                    return this.fetchWithRetry(endpoint, {
                        method: 'DELETE',
                        ...options
                    });
                },

                // PATCH request
                async patch(endpoint, body, options = {}) {
                    return this.fetchWithRetry(endpoint, {
                        method: 'PATCH',
                        body: JSON.stringify(body),
                        ...options
                    });
                },

                // Query builder for GET requests
                buildQuery(params) {
                    const query = new URLSearchParams();
                    Object.entries(params).forEach(([key, value]) => {
                        if (value !== undefined && value !== null) {
                            query.append(key, value);
                        }
                    });
                    return query.toString();
                },

                // Enhanced data fetching with query parameters
                async fetchData(endpoint, params = {}) {
                    const queryString = this.buildQuery(params);
                    const url = queryString ? `${endpoint}?${queryString}` : endpoint;
                    return this.get(url);
                },

                // Clear cache
                clearCache() {
                    this.cache.clear();
                },

                // Clear specific cache
                clearCacheForEndpoint(endpoint) {
                    for (const [key] of this.cache) {
                        if (key.startsWith(`GET:${endpoint}`)) {
                            this.cache.delete(key);
                        }
                    }
                }
            };

            // API Test functionality
            const APITest = {
                async testConnection() {
                    try {
                        const controller = new AbortController();
                        const timeoutId = setTimeout(
                            () => controller.abort(),
                            5000
                        );

                        const response = await fetch(
                            "/qlnhansu_V2/backend/src/public/api/test/connection",
                            {
                                signal: controller.signal,
                            headers: {
                                    "Content-Type": "application/json",
                                },
                            }
                        );
                        clearTimeout(timeoutId);

                        if (!response.ok) {
                            throw new Error(
                                `HTTP error! status: ${response.status}`
                            );
                        }

                        const data = await response.json();
                        return data.success;
                    } catch (error) {
                        console.error("API Test Error:", error);
                        return false;
                    }
                },

                async testDatabase() {
                    try {
                        const response = await fetch(
                            "/qlnhansu_V2/backend/src/public/api/test/database",
                            {
                                headers: {
                                    "Content-Type": "application/json",
                                },
                            }
                        );
                        if (!response.ok)
                            throw new Error("Database test failed");
                        const data = await response.json();
                        return data.success;
                    } catch (error) {
                        console.error("Database Test Error:", error);
                        return false;
                    }
                },

                async testSession() {
                    try {
                        const response = await fetch(
                            "/qlnhansu_V2/backend/src/public/api/test/session",
                            {
                                headers: {
                                    "Content-Type": "application/json",
                                },
                            }
                        );
                        if (!response.ok)
                            throw new Error("Session test failed");
                        const data = await response.json();
                        return data.active;
                    } catch (error) {
                        console.error("Session Test Error:", error);
                        return false;
                    }
                },

                async testFilePermissions() {
                    try {
                        const response = await fetch(
                            "/qlnhansu_V2/backend/src/public/api/test/permissions",
                            {
                                headers: {
                                    "Content-Type": "application/json",
                                },
                            }
                        );
                        if (!response.ok)
                            throw new Error("Permissions test failed");
                        const data = await response.json();
                        return data.writable;
                    } catch (error) {
                        console.error("Permissions Test Error:", error);
                        return false;
                    }
                },

                async testWithRetry(fn, maxRetries = 3) {
                    for (let i = 0; i < maxRetries; i++) {
                        try {
                            return await fn();
                        } catch (error) {
                            if (i === maxRetries - 1) throw error;
                            await new Promise((resolve) =>
                                setTimeout(resolve, 1000 * (i + 1))
                            );
                        }
                    }
                },

                async runAllTests() {
                    try {
                        const results = {
                            connection: await this.testWithRetry(() =>
                                this.testConnection()
                            ),
                            database: await this.testWithRetry(() =>
                                this.testDatabase()
                            ),
                            session: await this.testWithRetry(() =>
                                this.testSession()
                            ),
                            permissions: await this.testWithRetry(() =>
                                this.testFilePermissions()
                            ),
                        };

                        // Display results
                        const container = document.createElement("div");
                        container.className = "php-test";
                        container.innerHTML = `
                            <h2>System Test Results:</h2>
                            <p>API Connection: ${
                                results.connection ? "Success" : "Failed"
                            }</p>
                            <p>Database Connection: ${
                                results.database ? "Success" : "Failed"
                            }</p>
                            <p>Session: ${
                                results.session ? "Active" : "Inactive"
                            }</p>
                            <p>File Permissions: ${
                                results.permissions ? "Writable" : "Read-only"
                            }</p>
                        `;

                        document.body.insertBefore(
                            container,
                            document.body.firstChild
                        );
                    } catch (error) {
                        console.error("Failed to run tests:", error);
                        NotificationUtils.show(
                            "Failed to run system tests",
                            "error"
                        );
                    }
                },
            };

            // Database utilities
            const DatabaseUtils = {
                async fetchEmployees() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'employees'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching employees:", error);
                        return [];
                    }
                },

                async fetchDepartments() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'departments'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching departments:", error);
                        return [];
                    }
                },

                async fetchPositions() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'positions'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching positions:", error);
                        return [];
                    }
                },

                async fetchPerformances() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'performances'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching performances:", error);
                        return [];
                    }
                },

                async fetchPayroll() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'payroll'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching payroll:", error);
                        return [];
                    }
                },

                async fetchLeaves() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'leaves'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching leaves:", error);
                        return [];
                    }
                },

                async fetchTrainings() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'trainings'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching trainings:", error);
                        return [];
                    }
                },

                async fetchTasks() {
                    try {
                        const data = await APIUtils.fetchData('data.php', {
                            action: 'getData',
                            table: 'tasks'
                        });
                        if (!data || !data.success) return [];
                        return data.data;
                    } catch (error) {
                        console.error("Error fetching tasks:", error);
                        return [];
                    }
                }
            };

            // Dashboard functionality
            class Dashboard {
                constructor() {
                    this.isLoading = false;
                    this.charts = {};
                    this.data = {
                        employees: [],
                        departments: [],
                        positions: [],
                        performances: [],
                        payroll: [],
                        leaves: [],
                        trainings: [],
                        tasks: []
                    };
                    this.initCharts();
                    this.loadData();
                    this.setupEventListeners();
                }

                async loadData() {
                    if (this.isLoading) return;

                    this.isLoading = true;
                    document.getElementById("loadingOverlay").style.display = "flex";

                    try {
                        const [
                            employees,
                            departments,
                            positions,
                            performances,
                            payroll,
                            leaves,
                            trainings,
                            tasks
                        ] = await Promise.all([
                            APIUtils.fetchData('employees'),
                            APIUtils.fetchData('departments'),
                            APIUtils.fetchData('positions'),
                            APIUtils.fetchData('performances'),
                            APIUtils.fetchData('payroll'),
                            APIUtils.fetchData('leaves'),
                            APIUtils.fetchData('trainings'),
                            APIUtils.fetchData('tasks')
                        ]);

                        this.data = {
                            employees,
                            departments,
                            positions,
                            performances,
                            payroll,
                            leaves,
                            trainings,
                            tasks
                        };

                        await this.updateMetrics();
                        await this.updateCharts();
                        await this.updateRecentEmployees();
                    } catch (error) {
                        console.error("Error loading dashboard data:", error);
                        NotificationUtils.show("Lỗi khi tải dữ liệu dashboard", "error");
                    } finally {
                        this.isLoading = false;
                        document.getElementById("loadingOverlay").style.display = "none";
                    }
                }

                async updateMetrics() {
                    const { employees = [], performances = [], payroll = [], leaves = [] } = this.data;

                    try {
                        // Update employee metrics
                        document.getElementById("totalEmployees").textContent = employees.length || 0;
                        document.getElementById("activeEmployees").textContent = 
                            employees.filter(emp => emp?.status === "active").length || 0;
                        document.getElementById("inactiveEmployees").textContent = 
                            employees.filter(emp => emp?.status === "inactive").length || 0;

                        // Update performance metrics
                        const avgPerformance = performances.length > 0 
                            ? performances.reduce((sum, perf) => sum + (perf?.rating || 0), 0) / performances.length 
                            : 0;
                        document.getElementById("kpiCompletion").textContent = 
                            `${Math.round(avgPerformance)}%`;

                        // Update payroll metrics
                        const totalSalary = payroll.length > 0
                            ? payroll.reduce((sum, pay) => sum + (pay?.amount || 0), 0)
                            : 0;
                        document.getElementById("totalSalary").textContent = 
                            CommonUtils.formatCurrency(totalSalary);

                        // Update leaves metrics
                        const pendingLeaves = leaves.length > 0
                            ? leaves.filter(leave => leave?.status === "pending").length
                            : 0;
                        document.getElementById("pendingLeaves").textContent = pendingLeaves;

                        // Update attendance metrics
                        const today = new Date().toISOString().split('T')[0];
                        const todayAttendance = employees.length > 0
                            ? employees.filter(emp => emp?.last_attendance_date === today).length
                            : 0;
                        const attendanceRate = employees.length > 0 
                            ? (todayAttendance / employees.length) * 100 
                            : 0;
                        document.getElementById("todayAttendance").textContent = 
                            `${Math.round(attendanceRate)}%`;
                    } catch (error) {
                        console.error("Error updating metrics:", error);
                        NotificationUtils.show("Lỗi khi cập nhật số liệu", "error");
                    }
                }

                async updateCharts() {
                    const { employees, departments } = this.data;

                    // Update attendance chart
                    const attendanceData =
                        this.processAttendanceData(employees);
                    this.charts.attendance.data.labels = attendanceData.labels;
                    this.charts.attendance.data.datasets[0].data =
                        attendanceData.values;
                    this.charts.attendance.update();

                    // Update department chart
                    const departmentData =
                        this.processDepartmentData(departments);
                    this.charts.department.data.labels = departmentData.labels;
                    this.charts.department.data.datasets[0].data =
                        departmentData.values;
                    this.charts.department.update();
                }

                processAttendanceData(employees) {
                    // Group attendance by date and calculate rates
                    const attendanceByDate = {};
                    employees.forEach((emp) => {
                        if (!attendanceByDate[emp.last_attendance_date]) {
                            attendanceByDate[emp.last_attendance_date] = { present: 0, total: 0 };
                        }
                        attendanceByDate[emp.last_attendance_date].total++;
                        if (emp.status === "present") {
                            attendanceByDate[emp.last_attendance_date].present++;
                        }
                    });

                    const labels = Object.keys(attendanceByDate).sort();
                    const values = labels.map((date) => {
                        const { present, total } = attendanceByDate[date];
                        return (present / total) * 100;
                    });

                    return { labels, values };
                }

                processDepartmentData(departments) {
                    return {
                        labels: departments.map((d) => d.name),
                        values: departments.map((d) => d.employee_count),
                    };
                }

                async updateRecentEmployees() {
                    const { employees } = this.data;
                    const recentEmployees = employees
                        .sort(
                            (a, b) =>
                                new Date(b.join_date) - new Date(a.join_date)
                        )
                        .slice(0, 10);

                    const tbody = document.getElementById("recentEmployees");
                    tbody.innerHTML = recentEmployees
                        .map(
                            (emp) => `
                        <tr>
                            <td>${emp.employee_id}</td>
                            <td>${emp.full_name}</td>
                            <td>${emp.position}</td>
                            <td>${emp.department}</td>
                            <td>${CommonUtils.formatDate(emp.join_date)}</td>
                            <td>${CommonUtils.formatDate(emp.birth_date)}</td>
                            <td>${emp.phone}</td>
                            <td>${emp.email}</td>
                            <td>${emp.address}</td>
                            <td>${emp.status}</td>
                            <td>
                                <button class="btn btn-sm btn-primary" onclick="window.location.href='employees/edit.html?id=${
                                    emp.id
                                }'">
                                    <i class="fas fa-edit"></i>
                                </button>
                            </td>
                        </tr>
                    `
                        )
                        .join("");
                }

                cleanup() {
                    // Cleanup charts
                    Object.values(this.charts).forEach((chart) =>
                        chart.destroy()
                    );
                    this.charts = {};

                    // Remove event listeners
                    document
                        .getElementById("darkModeToggle")
                        .removeEventListener("click", this.toggleDarkMode);
                    document
                        .getElementById("logoutBtn")
                        .removeEventListener("click", this.handleLogout);
                    document
                        .getElementById("menuToggle")
                        .removeEventListener("click", this.toggleSidebar);
                    document
                        .getElementById("attendancePeriod")
                        .removeEventListener(
                            "change",
                            this.handleAttendancePeriodChange
                        );
                }

                initCharts() {
                    // Initialize attendance chart
                    const attendanceCtx = document.getElementById("attendanceChart");
                    if (attendanceCtx) {
                        if (this.charts.attendance) {
                            this.charts.attendance.destroy();
                        }
                        this.charts.attendance = new Chart(attendanceCtx, {
                            type: "line",
                            data: {
                                labels: [],
                                datasets: [
                                    {
                                        label: "Tỷ lệ chấm công",
                                        data: [],
                                        borderColor: "#4CAF50",
                                        tension: 0.1,
                                    },
                                ],
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                            },
                        });
                    }

                    // Initialize department chart
                    const departmentCtx = document.getElementById("departmentChart");
                    if (departmentCtx) {
                        if (this.charts.department) {
                            this.charts.department.destroy();
                        }
                        this.charts.department = new Chart(departmentCtx, {
                            type: "pie",
                            data: {
                                labels: [],
                                datasets: [
                                    {
                                        data: [],
                                        backgroundColor: [
                                            "#FF6384",
                                            "#36A2EB",
                                            "#FFCE56",
                                            "#4BC0C0",
                                            "#9966FF",
                                        ],
                                    },
                                ],
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                            },
                        });
                    }
                }

                setupEventListeners() {
                    // Dark mode toggle
                    document
                        .getElementById("darkModeToggle")
                        .addEventListener("click", () => {
                            UIUtils.toggleDarkMode();
                        });

                    // Logout button
                    document
                        .getElementById("logoutBtn")
                        .addEventListener("click", () => {
                            AuthUtils.logout();
                        });

                    // Menu toggle
                    document
                        .getElementById("menuToggle")
                        .addEventListener("click", () => {
                            UIUtils.toggleSidebar();
                        });

                    // Attendance period change
                    document
                        .getElementById("attendancePeriod")
                        .addEventListener("change", async (e) => {
                            await this.updateAttendanceChart(e.target.value);
                        });
                }

                async updateAttendanceChart(period) {
                    try {
                        const data = await APIUtils.fetchData(
                            `attendance/trend?period=${period}`
                        );
                        this.attendanceChart.data.labels = data.labels;
                        this.attendanceChart.data.datasets[0].data =
                            data.values;
                        this.attendanceChart.update();
                    } catch (error) {
                        console.error(
                            "Error updating attendance chart:",
                            error
                        );
                    }
                }
            }

            // Tab functionality
            class TabManager {
                constructor() {
                    this.currentTab = null;
                    this.tabs = new Set();
                    this.setupEventListeners();
                    this.initializeDefaultTab();
                }

                setupEventListeners() {
                    // Add event listeners for tab switching
                    document
                        .querySelectorAll(".nav-link[data-tab]")
                        .forEach((link) => {
                            link.addEventListener("click", (e) => {
                                e.preventDefault();
                                const tabId = link.getAttribute("data-tab");
                                this.switchTab(tabId);
                            });
                        });
                }

                initializeDefaultTab() {
                    const defaultTab =
                        document.querySelector(".nav-link.active");
                    if (defaultTab) {
                        const tabId = defaultTab.getAttribute("data-tab");
                        if (tabId) {
                            this.currentTab = tabId;
                            this.tabs.add(tabId);
                        }
                    }
                }

                switchTab(tabId) {
                    if (!tabId || !document.getElementById(tabId)) {
                        console.error(`Invalid tab ID: ${tabId}`);
                        return;
                    }

                    this.tabs.add(tabId);

                    document.querySelectorAll(".tab-pane").forEach((pane) => {
                        pane.classList.remove("show", "active");
                    });

                    document.querySelectorAll(".nav-link").forEach((link) => {
                        link.classList.remove("active");
                    });

                    const targetPane = document.getElementById(tabId);
                    const targetLink = document.querySelector(
                        `[data-tab="${tabId}"]`
                    );

                    if (targetPane && targetLink) {
                        targetPane.classList.add("show", "active");
                        targetLink.classList.add("active");
                        this.currentTab = tabId;
                    }
                }
            }

            // Initialize dashboard when DOM is loaded
            document.addEventListener("DOMContentLoaded", () => {
                const dashboard = new Dashboard();
                const tabManager = new TabManager();

                // Run system tests
                APITest.runAllTests().catch((error) => {
                    console.error("Failed to run system tests:", error);
                });

                // Check for dark mode preference
                if (localStorage.getItem("darkMode") === "true") {
                    document.body.classList.add("dark-mode");
                }

                // Cleanup on page unload
                window.addEventListener("unload", () => {
                    dashboard.cleanup();
                });

                // Handle submenu toggle on mobile
                const submenuToggles = document.querySelectorAll(
                    ".nav-item.has-submenu > .nav-link"
                );
                submenuToggles.forEach((toggle) => {
                    toggle.addEventListener("click", (e) => {
                        if (window.innerWidth <= 768) {
                            e.preventDefault();
                            const parent = toggle.parentElement;
                            parent.classList.toggle("active");

                            // Close other open submenus
                            document
                                .querySelectorAll(".nav-item.has-submenu")
                                .forEach((item) => {
                                    if (
                                        item !== parent &&
                                        item.classList.contains("active")
                                    ) {
                                        item.classList.remove("active");
                                    }
                                });
                        }
                    });
                });

                // Handle menu toggle
                const menuToggle = document.getElementById("menuToggle");
                const sidebar = document.querySelector(".sidebar");
                const sidebarOverlay =
                    document.getElementById("sidebarOverlay");

                menuToggle.addEventListener("click", () => {
                    sidebar.classList.toggle("active");
                    sidebarOverlay.classList.toggle("active");
                });

                // Close sidebar when clicking overlay
                sidebarOverlay.addEventListener("click", () => {
                    sidebar.classList.remove("active");
                    sidebarOverlay.classList.remove("active");
                });

                // Handle window resize
                window.addEventListener("resize", () => {
                    if (window.innerWidth > 768) {
                        sidebar.classList.remove("active");
                        sidebarOverlay.classList.remove("active");
                    }
                });
            });
        </script>
        <style>
            /* Dark Mode Variables */
            :root {
                /* Light mode default colors */
                --bg-primary: #ffffff;
                --bg-secondary: #f8f9fa;
                --text-primary: #333333;
                --text-secondary: #666666;
                --border-color: #dee2e6;
                --card-bg: #ffffff;
                --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
                --hover-bg: rgba(0, 0, 0, 0.05);
                --active-bg: rgba(0, 0, 0, 0.1);
                --input-bg: #ffffff;
                --input-border: #ced4da;
                --table-header-bg: #f8f9fa;
                --table-row-hover: rgba(0, 0, 0, 0.05);
                --scrollbar-track: #f1f1f1;
                --scrollbar-thumb: #c1c1c1;
                --modal-bg: #ffffff;
                --modal-overlay: rgba(0, 0, 0, 0.5);
                --header-bg: linear-gradient(135deg, #2C3E50 0%, #4CA1AF 100%);
                --header-text: #333;
                --sidebar-bg: #1a1a1a;
                --sidebar-text: #fff;
                --metric-card-bg: #ffffff;
                --metric-card-text: #333333;
                --chart-bg: #ffffff;
                --chart-text: #333333;
            }

            /* Dark mode colors */
            [data-theme="dark"] {
                --bg-primary: #333333;
                --bg-secondary: #1e1e1e;
                --text-primary: #ffffff;
                --text-secondary: #b0b0b0;
                --border-color: #333333;
                --card-bg: #1e1e1e;
                --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
                --hover-bg: rgba(255, 255, 255, 0.1);
                --active-bg: rgba(255, 255, 255, 0.15);
                --input-bg: #1e1e1e;
                --input-border: #333333;
                --table-header-bg: #1e1e1e;
                --table-row-hover: rgba(255, 255, 255, 0.1);
                --scrollbar-track: #1e1e1e;
                --scrollbar-thumb: #333333;
                --modal-bg: #1e1e1e;
                --modal-overlay: rgba(0, 0, 0, 0.7);
                --header-bg: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
                --header-text: #ffffff;
                --sidebar-bg: #121212;
                --sidebar-text: #ffffff;
                --metric-card-bg: #1e1e1e;
                --metric-card-text: #ffffff;
                --chart-bg: #1e1e1e;
                --chart-text: #ffffff;
            }

            /* Theme transition */
            .theme-transition,
            .theme-transition *,
            .theme-transition *:before,
            .theme-transition *:after {
                transition: all 0.3s ease !important;
            }

            /* Dark mode styles */
            [data-theme="dark"] body {
                background-color: var(--bg-primary);
                color: var(--text-primary);
            }

            /* Sidebar dark mode */
            [data-theme="dark"] .sidebar {
                background-color: var(--bg-secondary);
                border-right: 1px solid var(--border-color);
            }

            [data-theme="dark"] .nav-link {
                color: var(--text-primary);
            }

            [data-theme="dark"] .nav-link:hover {
                background-color: var(--hover-bg);
            }

            [data-theme="dark"] .nav-link.active {
                background-color: var(--active-bg);
            }

            /* Header dark mode */
            [data-theme="dark"] .header {
                background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
                border-bottom: 1px solid var(--border-color);
            }

            [data-theme="dark"] .header-left h1 {
                color: var(--text-primary);
            }

            [data-theme="dark"] .header-controls .form-control {
                background-color: var(--input-bg);
                border-color: var(--input-border);
                color: var(--text-primary);
            }

            [data-theme="dark"] .header-controls .form-control::placeholder {
                color: var(--text-secondary);
            }

            /* Metric cards dark mode */
            [data-theme="dark"] .metric-card {
                background-color: var(--card-bg);
                box-shadow: var(--card-shadow);
                border: 1px solid var(--border-color);
            }

            [data-theme="dark"] .stat-value {
                color: var(--text-primary);
            }

            [data-theme="dark"] .stat-label {
                color: var(--text-secondary);
            }

            /* Tables dark mode */
            [data-theme="dark"] .admin-table {
                background-color: var(--card-bg);
                color: var(--text-primary);
            }

            [data-theme="dark"] .admin-table thead th {
                background-color: var(--table-header-bg);
                color: var(--text-primary);
            }

            [data-theme="dark"] .admin-table tbody tr:hover {
                background-color: var(--table-row-hover);
            }

            /* Charts dark mode */
            [data-theme="dark"] .chart-container {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
            }

            /* Form elements dark mode */
            [data-theme="dark"] .form-control,
            [data-theme="dark"] .form-select {
                background-color: var(--input-bg);
                border-color: var(--input-border);
                color: var(--text-primary);
            }

            [data-theme="dark"] .form-control:focus,
            [data-theme="dark"] .form-select:focus {
                background-color: var(--input-bg);
                border-color: var(--border-color);
                color: var(--text-primary);
            }

            /* Buttons dark mode */
            [data-theme="dark"] .btn-primary {
                background-color: #3498db;
                border-color: #2980b9;
            }

            [data-theme="dark"] .btn-secondary {
                background-color: var(--bg-secondary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }

            /* Dropdown dark mode */
            [data-theme="dark"] .dropdown-menu {
                background-color: var(--card-bg);
                border-color: var(--border-color);
            }

            [data-theme="dark"] .dropdown-item {
                color: var(--text-primary);
            }

            [data-theme="dark"] .dropdown-item:hover {
                background-color: var(--hover-bg);
            }

            /* Scrollbar dark mode */
            [data-theme="dark"] ::-webkit-scrollbar-track {
                background: var(--scrollbar-track);
            }

            [data-theme="dark"] ::-webkit-scrollbar-thumb {
                background: var(--scrollbar-thumb);
            }

            /* Modal dark mode */
            [data-theme="dark"] .modal-content {
                background-color: var(--modal-bg);
                border-color: var(--border-color);
            }

            [data-theme="dark"] .modal-header {
                border-bottom-color: var(--border-color);
            }

            [data-theme="dark"] .modal-footer {
                border-top-color: var(--border-color);
            }

            /* Loading overlay dark mode */
            [data-theme="dark"] .loading-overlay {
                background-color: rgba(0, 0, 0, 0.7);
            }

            /* Notification dark mode */
            [data-theme="dark"] .notification {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
                color: var(--text-primary);
            }

            /* Accordion dark mode */
            [data-theme="dark"] .accordion-item {
                background-color: var(--card-bg);
                border-color: var(--border-color);
            }

            [data-theme="dark"] .accordion-button {
                background-color: var(--card-bg);
                color: var(--text-primary);
            }

            [data-theme="dark"] .accordion-button:not(.collapsed) {
                background-color: var(--active-bg);
                color: var(--text-primary);
            }

            /* Mobile app section dark mode */
            [data-theme="dark"] .mobile-app-stats .stat-card {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
            }

            [data-theme="dark"] .mobile-app-stats h4 {
                color: var(--text-primary);
            }

            [data-theme="dark"] .mobile-app-stats p {
                color: var(--text-secondary);
            }

            /* Footer dark mode */
            [data-theme="dark"] .footer {
                background-color: var(--bg-secondary);
                color: var(--text-secondary);
                border-top: 1px solid var(--border-color);
            }

            /* Header Styles */
            .header {
                margin-top: -70px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 1rem 2rem;
                background: linear-gradient(135deg, #2C3E50 0%, #4CA1AF 100%);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border-bottom: 1px solid rgba(255, 255, 255, 0.2);
                position: sticky;
                top: 0;
                border-radius: 5px;
                z-index: 1000;
                box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            }

            .header-left h1 {
                font-size: 1.5rem;
                color: #333;
                margin: 0;
            }

            .header-controls {
                display: flex;
                align-items: center;
                gap: 1rem;
            }

            .header-controls .form-control {
                background: rgba(255, 255, 255, 0.8);
                border: 1px solid rgba(0, 0, 0, 0.1);
                border-radius: 8px;
                padding: 0.5rem 1rem;
                backdrop-filter: blur(5px);
                -webkit-backdrop-filter: blur(5px);
            }

            .header-controls .form-control:focus {
                background: rgba(255, 255, 255, 0.9);
                box-shadow: 0 0 0 2px rgba(0, 0, 0, 0.1);
            }

            .dropdown-menu {
                background: rgba(255, 255, 255, 0.9);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.2);
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            }

            .dropdown-item {
                padding: 0.5rem 1rem;
                color: #333;
                transition: all 0.3s ease;
            }

            .dropdown-item:hover {
                background: rgba(0, 0, 0, 0.05);
            }

            /* Responsive */
            @media (max-width: 768px) {
                .header {
                    padding: 0.75rem 1rem;
                }

                .header-left h1 {
                    font-size: 1.25rem;
                }

                .header-controls {
                    gap: 0.5rem;
                }

                .header-controls .form-control {
                    width: 120px;
                }
            }

            /* Menu Styling */
            .sidebar {
                background-color: #1a1a1a;
                background-image: linear-gradient(43deg, #1a1a1a 0%, #2d2d2d 46%, #3d3d3d 100%);
                color: #fff;
                padding: 1rem;
                height: 100vh;
                position: fixed;
                left: 0;
                top: 0;
                width: 250px;
                transition: all 0.3s ease;
                overflow-y: auto;
                z-index: 1000;
            }

            .nav-menu {
                list-style: none;
                padding: 0;
                margin: 0;
            }

            .nav-item {
                position: relative;
                margin-bottom: 0.25rem;
            }

            .nav-link {
                display: flex;
                align-items: center;
                padding: 0.75rem 1rem;
                color: #fff;
                text-decoration: none;
                font-size: 0.9rem;
                transition: all 0.3s ease;
                border-radius: 4px;
            }

            .nav-link i {
                margin-right: 0.75rem;
                font-size: 1rem;
                width: 20px;
                text-align: center;
            }

            .nav-link:hover {
                background-color: rgba(255, 255, 255, 0.1);
            }

            .nav-link.active {
                background-color: rgba(255, 255, 255, 0.15);
            }

            /* Submenu Styling */
            .submenu {
                list-style: none;
                padding: 0;
                margin: 0;
                background-color: rgba(0, 0, 0, 0.2);
                border-radius: 4px;
                display: none;
                position: relative;
                width: 100%;
                z-index: 1001;
                margin-top: 0.25rem;
            }

            .nav-item.has-submenu.open > .submenu {
                display: block;
            }

            .submenu .nav-link {
                padding: 0.75rem 1rem 0.75rem 2.5rem;
                font-size: 0.85rem;
                white-space: nowrap;
                background-color: #2d2d2d;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }

            .submenu .nav-link:last-child {
                border-bottom: none;
            }

            .nav-item.has-submenu > .nav-link {
                position: relative;
            }

            .nav-item.has-submenu > .nav-link .fa-chevron-right {
                position: absolute;
                right: 1rem;
                transition: transform 0.3s ease;
            }

            .nav-item.has-submenu.open > .nav-link .fa-chevron-right {
                transform: rotate(90deg);
            }

            /* Main content adjustment */
            .main-content {
                margin-left: 250px;
                padding: 1rem;
                min-height: 100vh;
                padding-top: 80px;
                position: relative;
                z-index: 1;
            }

            /* Mobile Menu Toggle */
            .menu-toggle {
                display: none;
                position: fixed;
                top: 1rem;
                left: 1rem;
                z-index: 1001;
                background: none;
                border: none;
                color: #fff;
                font-size: 1.5rem;
                cursor: pointer;
            }

            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background-color: rgba(0, 0, 0, 0.5);
                z-index: 999;
            }

            @media (max-width: 768px) {
                .menu-toggle {
                    display: block;
                }

                .sidebar {
                    transform: translateX(-100%);
                }

                .sidebar.active {
                    transform: translateX(0);
                }

                .sidebar-overlay.active {
                    display: block;
                }

                .main-content {
                    margin-left: 0;
                }
            }

            /* Điều chỉnh main content để không bị che bởi sidebar */
            .main-content {
                margin-left: 250px;
                padding: 1rem;
                min-height: 100vh;
                padding-top: 80px; /* Thêm padding top để tránh bị che bởi header */
            }

            /* Responsive cho mobile */
            @media (max-width: 768px) {
                .sidebar {
                    transform: translateX(-100%);
                }

                .sidebar.active {
                    transform: translateX(0);
                }

                .main-content {
                    margin-left: 0;
                    padding-top: 80px;
                }
            }

            .nav-link {
                display: flex;
                align-items: center;
                padding: 0.5rem 1rem;
                color: #fff;
                text-decoration: none;
                font-size: 0.85rem;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                transition: all 0.3s ease;
            }

            .nav-link i {
                margin-right: 0.75rem;
                font-size: 1rem;
                width: 20px;
                text-align: center;
                color: #fff;
                flex-shrink: 0;
            }

            .nav-link span {
                flex: 1;
                color: #fff;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }

            .nav-link:hover {
                background-color: rgba(255, 255, 255, 0.1);
                width: 100%;
            }

            .nav-link.active {
                background-color: rgba(255, 255, 255, 0.15);
            }

            /* Recent Menu */
            .recent-menu {
                margin-top: 1rem;
                padding-top: 1rem;
                border-top: 1px solid rgba(255, 255, 255, 0.1);
            }

            .recent-menu h3 {
                font-size: 0.9rem;
                color: rgba(255, 255, 255, 0.7);
                margin-bottom: 0.5rem;
            }

            /* Theme Toggle Styles */
            .theme-toggle-wrapper {
                display: flex;
                align-items: center;
                margin: 0 10px;
            }

            .theme-toggle {
                width: 32px;
                height: 32px;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.1);
                display: flex;
                align-items: center;
                justify-content: center;
                cursor: pointer;
                transition: all 0.3s ease;
                position: relative;
                overflow: hidden;
            }

            .theme-toggle:hover {
                background: rgba(255, 255, 255, 0.2);
            }

            .theme-toggle:not(.dark-mode) {
                background: #ffffff;
                box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            }

            .theme-toggle .sun,
            .theme-toggle .moon {
                position: absolute;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                width: 24px;
                height: 24px;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: all 0.3s ease;
                border-radius: 50%;
            }

            .theme-toggle .sun svg,
            .theme-toggle .moon svg {
                width: 20px;
                height: 20px;
                stroke: currentColor;
            }

            .theme-toggle.dark-mode .sun {
                opacity: 0;
                transform: translate(-50%, 20px);
            }

            .theme-toggle.dark-mode .moon {
                opacity: 1;
                transform: translate(-50%, -50%);
            }

            .theme-toggle:not(.dark-mode) .sun {
                opacity: 1;
                transform: translate(-50%, -50%);
                color: #333; /* Màu tối cho icon mặt trời trên nền trắng */
            }

            .theme-toggle:not(.dark-mode) .moon {
                opacity: 0;
                transform: translate(-50%, -20px);
            }

            /* Dark mode adjustments */
            .dark-mode .theme-toggle {
                background: rgba(255, 255, 255, 0.1);
            }

            .dark-mode .theme-toggle:hover {
                background: rgba(255, 255, 255, 0.2);
            }

            .dark-mode .theme-toggle .moon svg {
                stroke: #fff;
            }

            /* Responsive adjustments */
            @media (max-width: 768px) {
                .theme-toggle {
                    width: 28px;
                    height: 28px;
                }
                
                .theme-toggle .sun,
                .theme-toggle .moon {
                    width: 20px;
                    height: 20px;
                }
                
                .theme-toggle .sun svg,
                .theme-toggle .moon svg {
                    width: 16px;
                    height: 16px;
                }
            }

            /* Notification Styles */
            .notification {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
                color: var(--text-primary);
            }

            /* Loading Overlay */
            .loading-overlay {
                background-color: var(--modal-overlay);
            }

            /* Modal Styles */
            .modal-content {
                background-color: var(--modal-bg);
                border-color: var(--border-color);
            }

            .modal-header {
                border-bottom-color: var(--border-color);
            }

            .modal-footer {
                border-top-color: var(--border-color);
            }

            /* Button Styles */
            .btn-primary {
                background-color: #3498db;
                border-color: #2980b9;
            }

            .btn-secondary {
                background-color: var(--bg-secondary);
                border-color: var(--border-color);
                color: var(--text-primary);
            }

            /* Input Placeholder */
            ::placeholder {
                color: var(--text-secondary);
                opacity: 0.7;
            }

            /* Scrollbar Styles */
            ::-webkit-scrollbar-track {
                background: var(--scrollbar-track);
            }

            ::-webkit-scrollbar-thumb {
                background: var(--scrollbar-thumb);
            }

            /* Chart Tooltip */
            .chartjs-tooltip {
                background-color: var(--card-bg) !important;
                border: 1px solid var(--border-color) !important;
                color: var(--text-primary) !important;
            }

            /* Data Section */
            .data-section {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
            }

            .section-header {
                border-bottom: 1px solid var(--border-color);
            }

            .section-title {
                color: var(--text-primary);
            }

            /* AI Analytics Section */
            .ai-prediction-card, .sentiment-analysis-card {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
            }

            /* Gamification Section */
            .leaderboard {
                background-color: var(--card-bg);
                border: 1px solid var(--border-color);
            }

            /* Table Hover Effects */
            .admin-table tbody tr:hover {
                background-color: var(--table-row-hover);
            }

            /* Menu Search */
            .menu-search input {
                background-color: var(--input-bg);
                border-color: var(--input-border);
                color: var(--text-primary);
            }

            /* Recent Menu */
            .recent-menu {
                border-top-color: var(--border-color);
            }

            .recent-menu h3 {
                color: var(--text-secondary);
            }
        </style>
    </head>
    <body>
        <!-- Add notification container -->
        <div class="notification-container" id="notificationContainer"></div>

        <!-- Add loading overlay -->
        <div class="loading-overlay" id="loadingOverlay">
            <div class="text-center">
                <div class="loading-spinner"></div>
                <div class="loading-text">Đang tải dữ liệu...</div>
            </div>
        </div>

        <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
        </button>
        <div class="sidebar-overlay" id="sidebarOverlay"></div>

        <div class="dashboard-container">
            <!-- Sidebar -->
            <aside class="sidebar">
                <div class="sidebar-header">
                    <img src="./male.png" alt="User Avatar" />
                    <h2 style="color: #3498db;">VNPT</h2>
                </div>

                <!-- Menu Search -->
                <div class="menu-search">
                    <input type="text" placeholder="Tìm kiếm menu..." />
                </div>

                <nav>
                    <ul class="nav-menu">
                        <li class="nav-item" data-menu-id="dashboard">
                            <a href="dashboard.php" class="nav-link active">
                                <i class="fas fa-tachometer-alt"></i>
                                <span>Dashboard</span>
                                <i class="fas fa-star favorite"></i>
                            </a>
                        </li>
                        <li
                            class="nav-item has-submenu"
                            data-menu-id="employees"
                        >
                            <a href="#" class="nav-link">
                                <i class="fas fa-users"></i>
                                <span>Nhân viên</span>
                                <i class="fas fa-chevron-right"></i>
                                <i class="fas fa-star favorite"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="employees/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách nhân viên</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="employees/add.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-plus"></i>
                                        <span>Thêm nhân viên</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="employees/edit.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-edit"></i>
                                        <span>Chỉnh sửa hồ sơ</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="employees/contract.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-file-contract"></i>
                                        <span>Hợp đồng</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="employees/view.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-eye"></i>
                                        <span>Xem hồ sơ</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-clock"></i>
                                <span>Chấm công</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="attendance/history.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-history"></i>
                                        <span>Lịch sử chấm công</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="attendance/check.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-check"></i>
                                        <span>Chấm công</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="attendance/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách chấm công</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="attendance/config.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-cog"></i>
                                        <span>Cấu hình chấm công</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="attendance/reports.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-chart-bar"></i>
                                        <span>Báo cáo chấm công</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-money-bill-wave"></i>
                                <span>Lương</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a href="salary/list.html" class="nav-link">
                                        <i class="fas fa-list"></i>
                                        <span>Bảng lương</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="salary/reports.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-chart-bar"></i>
                                        <span>Báo cáo lương</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="salary/config.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-cog"></i>
                                        <span>Cấu hình lương</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="salary/calculate.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-calculator"></i>
                                        <span>Tính lương</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="salary/payslip.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-file-invoice"></i>
                                        <span>Phiếu lương</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="salary/history.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-history"></i>
                                        <span>Lịch sử điều chỉnh</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-calendar-alt"></i>
                                <span>Nghỉ phép</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="leave/register.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-plus"></i>
                                        <span>Đăng ký nghỉ phép</span>
                                    </a>
                                </li>
                                <li>
                                    <a href="leave/list.html" class="nav-link">
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách nghỉ phép</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="leave/config.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-cog"></i>
                                        <span>Cấu hình nghỉ phép</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="leave/reports.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-chart-bar"></i>
                                        <span>Báo cáo nghỉ phép</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-chart-line"></i>
                                <span>Hiệu suất & KPI</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="performance/employee.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Đánh giá hiệu suất</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="performance/kpi.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-bullseye"></i>
                                        <span>Cấu hình KPI</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="performance/reports.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-chart-bar"></i>
                                        <span>Báo cáo hiệu suất</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="performance/evaluation.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-star"></i>
                                        <span>Đánh giá nhân viên</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-building"></i>
                                <span>Phòng ban</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="departments/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách phòng ban</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-certificate"></i>
                                <span>Bằng cấp</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="certificates/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách bằng cấp</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="certificates/add.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-plus"></i>
                                        <span>Thêm bằng cấp</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="certificates/edit.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-edit"></i>
                                        <span>Chỉnh sửa bằng cấp</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="certificates/Degree.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-graduation-cap"></i>
                                        <span>Quản lý bằng cấp</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-file-alt"></i>
                                <span>Tài liệu</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="documents/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách tài liệu</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="documents/upload.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-upload"></i>
                                        <span>Upload tài liệu</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="documents/document.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-file"></i>
                                        <span>Quản lý tài liệu</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="documents/view_document.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-eye"></i>
                                        <span>Xem tài liệu</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-tools"></i>
                                <span>Thiết bị</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="equipment/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách thiết bị</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="equipment/assign.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-share"></i>
                                        <span>Cấp phát thiết bị</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="reports/list.html" class="nav-link">
                                <i class="fas fa-chart-bar"></i>
                                <span>Báo cáo</span>
                            </a>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-chart-line"></i>
                                <span>Hiệu suất & KPI</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="reports/employee.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Đánh giá hiệu suất</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-user-plus"></i>
                                <span>Tuyển dụng</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="recruitment/positions.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-briefcase"></i>
                                        <span>Vị trí tuyển dụng</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="recruitment/candidates.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-users"></i>
                                        <span>Quản lý ứng viên</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="recruitment/interviews.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-comments"></i>
                                        <span>Lịch phỏng vấn</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="recruitment/onboarding.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-user-check"></i>
                                        <span>Onboarding</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-gift"></i>
                                <span>Phúc lợi</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="benefits/insurance.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-shield-alt"></i>
                                        <span>Bảo hiểm</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="benefits/policies.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-file-contract"></i>
                                        <span>Chính sách phúc lợi</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-project-diagram"></i>
                                <span>Dự án</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="projects/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách dự án</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="projects/tasks.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-tasks"></i>
                                        <span>Quản lý công việc</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="projects/resources.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-cubes"></i>
                                        <span>Quản lý tài nguyên</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-cogs"></i>
                                <span>Cài đặt</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="settings/security.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-shield-alt"></i>
                                        <span>Bảo mật</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="settings/integrations.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-plug"></i>
                                        <span>Tích hợp</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="settings/backup.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-database"></i>
                                        <span>Sao lưu</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item has-submenu">
                            <a href="#" class="nav-link">
                                <i class="fas fa-graduation-cap"></i>
                                <span>Đào tạo</span>
                                <i class="fas fa-chevron-right"></i>
                            </a>
                            <ul class="submenu">
                                <li>
                                    <a
                                        href="training/courses.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Quản lý khóa đào tạo</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="training/register.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-plus"></i>
                                        <span>Đăng ký đào tạo</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="training/list.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-list"></i>
                                        <span>Danh sách đăng ký</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="training/evaluation.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-star"></i>
                                        <span>Đánh giá kết quả</span>
                                    </a>
                                </li>
                                <li>
                                    <a
                                        href="training/reports.html"
                                        class="nav-link"
                                    >
                                        <i class="fas fa-chart-bar"></i>
                                        <span>Báo cáo đào tạo</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a href="#" class="nav-link" id="logoutBtn">
                                <i class="fas fa-sign-out-alt"></i>
                                <span>Đăng xuất</span>
                            </a>
                        </li>
                    </ul>
                </nav>

                <!-- Recent Menu -->
                <div class="recent-menu">
                    <h3>Menu gần đây</h3>
                </div>
            </aside>

            <!-- Main Content -->
            <main class="main-content">
                <!-- Improved Header -->
                <header class="header">
                    <div class="header-left">
                        <h1 style="color: #F8D800;">Admin Dashboard</h1>
                    </div>
                    <div class="header-right">
                        <div class="header-controls">
                            <input type="text" style="background-color: #333333; color: #ffffff;" class="form-control" placeholder="Search..." />
                            <div class="theme-toggle-wrapper">
                                <div class="theme-toggle" id="themeToggle" role="button" tabindex="0">
                                    <div class="sun">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <circle cx="12" cy="12" r="5"/>
                                            <line x1="12" y1="1" x2="12" y2="3"/>
                                            <line x1="12" y1="21" x2="12" y2="23"/>
                                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
                                            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                                            <line x1="1" y1="12" x2="3" y2="12"/>
                                            <line x1="21" y1="12" x2="23" y2="12"/>
                                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
                                            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                                        </svg>
                                    </div>
                                    <div class="moon">
                                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                                        </svg>
                                    </div>
                                </div>
                            </div>
                            <div class="dropdown">
                                <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user-circle"></i> Admin
                                </button>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="#">Profile</a></li>
                                    <li><a class="dropdown-item" href="#">Settings</a></li>
                                    <li><a class="dropdown-item" href="#" id="logoutBtn">Logout</a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Priority Metrics Grid -->
                <section class="metrics-grid">
                    <div class="row g-3">
                        <!-- Priority 1 Metrics -->
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-1 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="totalEmployees">
                                        0
                                    </div>
                                    <div class="stat-label">Tổng nhân viên</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-1 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-bullseye"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="kpiCompletion">
                                        0%
                                    </div>
                                    <div class="stat-label">Hoàn thành KPI</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-1 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="newCandidates">
                                        0
                                    </div>
                                    <div class="stat-label">Ứng viên mới</div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-1 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-project-diagram"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="activeProjects">
                                        0
                                    </div>
                                    <div class="stat-label">
                                        Dự án đang chạy
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-1 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-user-check"></i>
                                </div>
                                <div class="stat-content">
                                    <div
                                        class="stat-value"
                                        id="activeEmployees"
                                    >
                                        0
                                    </div>
                                    <div class="stat-label">
                                        Nhân viên đang hoạt động
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-1 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-clock"></i>
                                </div>
                                <div class="stat-content">
                                    <div
                                        class="stat-value"
                                        id="todayAttendance"
                                    >
                                        0%
                                    </div>
                                    <div class="stat-label">
                                        Tỷ lệ chấm công hôm nay
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Priority 2 Metrics -->
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-2 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-calendar-alt"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="pendingLeaves">
                                        0
                                    </div>
                                    <div class="stat-label">
                                        Đơn xin nghỉ phép chờ duyệt
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-2 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-money-bill-wave"></i>
                                </div>
                                <div class="stat-content">
                                    <div class="stat-value" id="totalSalary">
                                        0
                                    </div>
                                    <div class="stat-label">
                                        Tổng quỹ lương tháng
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-12 col-sm-6 col-md-4 col-lg-3">
                            <div class="metric-card priority-2 h-100">
                                <div class="stat-icon">
                                    <i class="fas fa-user-times"></i>
                                </div>
                                <div class="stat-content">
                                    <div
                                        class="stat-value"
                                        id="inactiveEmployees"
                                    >
                                        0
                                    </div>
                                    <div class="stat-label">
                                        Nhân viên không hoạt động
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <section class="data-tabs">
                    <div class="tab-content" id="recentTabsContent">
                        <div
                            class="tab-pane fade show active"
                            id="employees"
                            role="tabpanel"
                        >
                            <div style="margin-top: 30px;" class="data-section">
                                <div class="section-header">
                                    <h3 class="section-title">Nhân viên mới</h3>
                                    <div class="action-buttons">
                                        <button
                                            class="btn btn-primary"
                                            onclick="window.location.href='./employees/list.html'"
                                        >
                                            Xem tất cả
                                        </button>
                                    </div>
                                </div>
                                <div class="table-responsive">
                                    <table class="admin-table">
                                        <thead>
                                            <tr>
                                                <th>Mã NV</th>
                                                <th>Họ tên</th>
                                                <th>Chức vụ</th>
                                                <th>Phòng ban</th>
                                                <th>Ngày vào làm</th>
                                                <th>Ngày sinh</th>
                                                <th>SĐT</th>
                                                <th>Email</th>
                                                <th>Địa chỉ</th>
                                                <th>Trạng thái</th>
                                                <th>Thao tác</th>
                                            </tr>
                                        </thead>
                                        <tbody id="recentEmployees">
                                            <!-- Data will be loaded dynamically -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>

                        <div
                            class="tab-pane fade"
                            id="activities"
                            role="tabpanel"
                        >
                            <div class="data-section">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        Hoạt động gần đây
                                    </h3>
                                    <div class="activity-filter">
                                        <select
                                            id="activityType"
                                            class="form-select"
                                        >
                                            <option value="all">
                                                Tất cả hoạt động
                                            </option>
                                            <option value="login">
                                                Đăng nhập
                                            </option>
                                            <option value="edit">
                                                Chỉnh sửa
                                            </option>
                                            <option value="view">
                                                Xem thông tin
                                            </option>
                                            <option value="delete">Xóa</option>
                                        </select>
                                        <input
                                            type="date"
                                            id="activityDate"
                                            class="form-control"
                                        />
                                        <input
                                            type="text"
                                            class="form-control"
                                            placeholder="Tìm kiếm người dùng..."
                                        />
                                    </div>
                                </div>
                                <div id="recentActivities">
                                    <!-- Data will be loaded dynamically -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>
                <!-- Charts Section -->
                <section class="charts-section">
                    <div class="row g-3">
                        <div class="col-12 col-lg-8">
                            <div class="data-section main-chart h-100">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        Xu hướng chấm công
                                    </h3>
                                    <div class="chart-controls">
                                        <select
                                            class="form-select"
                                            id="attendancePeriod"
                                        >
                                            <option value="week">Tuần</option>
                                            <option value="month">Tháng</option>
                                            <option value="quarter">Quý</option>
                                        </select>
                                        <button
                                            class="btn"
                                            onclick="ExportUtils.exportChart('attendanceChart')"
                                        >
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="attendanceChart"></canvas>
                                </div>
                            </div>
                        </div>

                        <div class="col-12 col-lg-4">
                            <div class="data-section h-100">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        Phân bố nhân viên theo phòng ban
                                    </h3>
                                    <div class="chart-controls">
                                        <button
                                            class="btn"
                                            onclick="ExportUtils.exportChart('departmentChart')"
                                        >
                                            <i class="fas fa-download"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="chart-container">
                                    <canvas id="departmentChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Tabs Section -->

                <!-- Collapsible Sections -->
                <section class="additional-sections">
                    <div class="accordion" id="additionalSectionsAccordion">
                        <!-- AI Predictions Section -->
                        <div class="accordion-item">
                            <h2 class="accordion-header" id="aiSectionHeader">
                                <button
                                    class="accordion-button"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#aiSection"
                                >
                                    Dự đoán và Phân tích
                                </button>
                            </h2>
                            <div
                                id="aiSection"
                                class="accordion-collapse collapse show"
                            >
                                <div class="accordion-body">
                                    <div class="data-section">
                                        <div class="section-header">
                                            <h3 class="section-title">
                                                Dự đoán và Phân tích
                                            </h3>
                                        </div>
                                        <div class="ai-prediction-card">
                                            <h4>Dự đoán xu hướng nhân sự</h4>
                                            <div id="hrTrends"></div>
                                        </div>
                                        <div class="ai-prediction-card">
                                            <h4>Phân tích tâm lý nhân viên</h4>
                                            <div id="sentimentAnalysis"></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Gamification Section -->
                        <div class="accordion-item">
                            <h2
                                class="accordion-header"
                                id="gamificationSectionHeader"
                            >
                                <button
                                    class="accordion-button collapsed"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#gamificationSection"
                                >
                                    Gamification
                                </button>
                            </h2>
                            <div
                                id="gamificationSection"
                                class="accordion-collapse collapse"
                            >
                                <div class="accordion-body">
                                    <div class="data-section">
                                        <div class="section-header">
                                            <h3 class="section-title">
                                                Gamification
                                            </h3>
                                        </div>
                                        <div class="leaderboard">
                                            <h4>Bảng xếp hạng</h4>
                                            <div id="employeeRankings"></div>
                                        </div>
                                        <div class="achievements">
                                            <h4>Thành tích</h4>
                                            <div
                                                id="employeeAchievements"
                                            ></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Thêm section mới cho AI & Analytics -->
                <section class="ai-analytics-section">
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="data-section">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        Dự đoán xu hướng nhân sự
                                    </h3>
                                </div>
                                <div class="ai-prediction-card">
                                    <div class="prediction-chart">
                                        <canvas id="hrTrendsChart"></canvas>
                                    </div>
                                    <div class="prediction-insights">
                                        <h4>Phân tích</h4>
                                        <ul id="hrTrendsInsights"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4">
                            <div class="data-section">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        Phân tích tâm lý nhân viên
                                    </h3>
                                </div>
                                <div class="sentiment-analysis-card">
                                    <div class="sentiment-chart">
                                        <canvas id="sentimentChart"></canvas>
                                    </div>
                                    <div class="sentiment-insights">
                                        <h4>Đề xuất</h4>
                                        <ul id="sentimentInsights"></ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Thêm section mới cho Gamification -->
                <section class="gamification-section">
                    <div class="row">
                        <div class="col-lg-8 mb-4">
                            <div class="data-section">
                                <div class="section-header">
                                    <h3 class="section-title">Bảng xếp hạng</h3>
                                </div>
                                <div class="leaderboard">
                                    <table class="table">
                                        <thead>
                                            <tr>
                                                <th>Hạng</th>
                                                <th>Nhân viên</th>
                                                <th>Điểm</th>
                                                <th>Thành tích</th>
                                            </tr>
                                        </thead>
                                        <tbody id="leaderboardTable">
                                            <!-- Data will be dynamically loaded -->
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-4 mb-4">
                            <div class="data-section">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        Thành tích gần đây
                                    </h3>
                                </div>
                                <div id="recentAchievements">
                                    <!-- Data will be dynamically loaded -->
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- Thêm section mới cho Mobile App -->
                <section class="mobile-app-section">
                    <div class="row">
                        <div class="col-12">
                            <div class="data-section">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        Ứng dụng di động
                                    </h3>
                                </div>
                                <div class="mobile-app-stats">
                                    <div class="row">
                                        <div class="col-md-4">
                                            <div class="stat-card">
                                                <i
                                                    class="fas fa-mobile-alt"
                                                ></i>
                                                <h4>Lượt tải</h4>
                                                <p id="appDownloads">0</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="stat-card">
                                                <i
                                                    class="fas fa-user-check"
                                                ></i>
                                                <h4>Người dùng hoạt động</h4>
                                                <p id="activeUsers">0</p>
                                            </div>
                                        </div>
                                        <div class="col-md-4">
                                            <div class="stat-card">
                                                <i class="fas fa-bell"></i>
                                                <h4>Thông báo đã gửi</h4>
                                                <p id="notificationsSent">0</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

                <footer class="footer">
                    <p>&copy; 2023 VNPT. All rights reserved.</p>
                </footer>
            </main>
        </div>

        <script>
            function logout() {
                window.location.href =
                    "/QLNhanSu_version1/public/login_new.html";
            }

            // Menu and Submenu Handling
            document.addEventListener("DOMContentLoaded", function () {
                const menuItems = document.querySelectorAll(
                    ".nav-item.has-submenu"
                );

                menuItems.forEach((item) => {
                    const link = item.querySelector(".nav-link");
                    const submenu = item.querySelector(".submenu");
                    const chevron = item.querySelector(".fa-chevron-right");

                    // Handle click events
                    link.addEventListener("click", function (e) {
                        e.preventDefault();

                        // Close other open submenus
                        menuItems.forEach((otherItem) => {
                            if (otherItem !== item) {
                                otherItem.classList.remove("open");
                                const otherChevron =
                                    otherItem.querySelector(
                                        ".fa-chevron-right"
                                    );
                                if (otherChevron) {
                                    otherChevron.style.transform =
                                        "rotate(0deg)";
                                }
                            }
                        });

                        // Toggle current submenu
                        item.classList.toggle("open");
                        if (chevron) {
                            chevron.style.transform = item.classList.contains(
                                "open"
                            )
                                ? "rotate(90deg)"
                                : "rotate(0deg)";
                        }
                    });

                    // Handle hover events for desktop
                    if (window.innerWidth > 768) {
                        item.addEventListener("mouseenter", function () {
                            item.classList.add("open");
                            if (chevron) {
                                chevron.style.transform = "rotate(90deg)";
                            }
                        });

                        item.addEventListener("mouseleave", function () {
                            item.classList.remove("open");
                            if (chevron) {
                                chevron.style.transform = "rotate(0deg)";
                            }
                        });
                    }
                });

                // Handle window resize
                window.addEventListener("resize", function () {
                    const isMobile = window.innerWidth <= 768;
                    menuItems.forEach((item) => {
                        const chevron = item.querySelector(".fa-chevron-right");
                        if (isMobile) {
                            item.classList.remove("open");
                            if (chevron) {
                                chevron.style.transform = "rotate(0deg)";
                            }
                        }
                    });
                });
            });
        </script>

        <!-- Theme Toggle Script -->
        <script>
            document.addEventListener('DOMContentLoaded', () => {
                const themeToggle = document.getElementById('themeToggle');
                const prefersDarkScheme = window.matchMedia('(prefers-color-scheme: dark)');
                
                // Check for saved theme preference or system preference
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    document.documentElement.setAttribute('data-theme', savedTheme);
                    themeToggle.classList.toggle('dark-mode', savedTheme === 'dark');
                } else if (prefersDarkScheme.matches) {
                    document.documentElement.setAttribute('data-theme', 'dark');
                    themeToggle.classList.add('dark-mode');
                }

                // Toggle theme function
                function toggleTheme() {
                    const currentTheme = document.documentElement.getAttribute('data-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    
                    // Smooth transition for theme change
                    document.documentElement.classList.add('theme-transition');
                    document.documentElement.setAttribute('data-theme', newTheme);
                    localStorage.setItem('theme', newTheme);
                    
                    // Toggle the switch appearance
                    themeToggle.classList.toggle('dark-mode');
                    
                    // Remove transition class
                    setTimeout(() => {
                        document.documentElement.classList.remove('theme-transition');
                    }, 500);
                }

                // Event listeners
                themeToggle.addEventListener('click', toggleTheme);
                themeToggle.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' || e.key === ' ') {
                        e.preventDefault();
                        toggleTheme();
                    }
                });

                // Listen for system theme changes
                prefersDarkScheme.addEventListener('change', (e) => {
                    if (!localStorage.getItem('theme')) {
                        const newTheme = e.matches ? 'dark' : 'light';
                        document.documentElement.setAttribute('data-theme', newTheme);
                        themeToggle.classList.toggle('dark-mode', e.matches);
                    }
                });
            });
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const menuItems = document.querySelectorAll('.nav-item.has-submenu');
                const isMobile = () => window.innerWidth <= 768;

                function handleMenuInteraction(item, event) {
                    const link = item.querySelector('.nav-link');
                    const submenu = item.querySelector('.submenu');
                    const chevron = item.querySelector('.fa-chevron-right');

                    if (!link || !submenu) return;

                    if (event.type === 'click' && isMobile()) {
                        event.preventDefault();
                        toggleSubmenu(item, chevron);
                    } else if (event.type === 'mouseenter' && !isMobile()) {
                        openSubmenu(item, chevron);
                    } else if (event.type === 'mouseleave' && !isMobile()) {
                        closeSubmenu(item, chevron);
                    }
                }

                function toggleSubmenu(item, chevron) {
                    const isOpen = item.classList.contains('open');
                    
                    // Close other open submenus
                    menuItems.forEach(otherItem => {
                        if (otherItem !== item) {
                            closeSubmenu(otherItem, otherItem.querySelector('.fa-chevron-right'));
                        }
                    });

                    if (isOpen) {
                        closeSubmenu(item, chevron);
                    } else {
                        openSubmenu(item, chevron);
                    }
                }

                function openSubmenu(item, chevron) {
                    item.classList.add('open');
                    if (chevron) {
                        chevron.style.transform = 'rotate(90deg)';
                    }
                }

                function closeSubmenu(item, chevron) {
                    item.classList.remove('open');
                    if (chevron) {
                        chevron.style.transform = 'rotate(0deg)';
                    }
                }

                // Initialize menu items
                menuItems.forEach(item => {
                    const link = item.querySelector('.nav-link');
                    if (!link) return;

                    // Click event for mobile
                    link.addEventListener('click', (e) => handleMenuInteraction(item, e));

                    // Hover events for desktop
                    if (!isMobile()) {
                        item.addEventListener('mouseenter', (e) => handleMenuInteraction(item, e));
                        item.addEventListener('mouseleave', (e) => handleMenuInteraction(item, e));
                    }
                });

                // Handle window resize
                window.addEventListener('resize', () => {
                    const mobile = isMobile();
                    menuItems.forEach(item => {
                        const chevron = item.querySelector('.fa-chevron-right');
                        
                        if (mobile) {
                            // Remove desktop hover events
                            item.removeEventListener('mouseenter', null);
                            item.removeEventListener('mouseleave', null);
                            // Close all submenus on mobile
                            closeSubmenu(item, chevron);
                        } else {
                            // Add desktop hover events
                            item.addEventListener('mouseenter', (e) => handleMenuInteraction(item, e));
                            item.addEventListener('mouseleave', (e) => handleMenuInteraction(item, e));
                        }
                    });
                });
            });
        </script>

        <script>
            document.addEventListener('DOMContentLoaded', function() {
                // Menu toggle functionality
                const menuToggle = document.getElementById('menuToggle');
                const sidebar = document.querySelector('.sidebar');
                const sidebarOverlay = document.getElementById('sidebarOverlay');

                if (menuToggle && sidebar && sidebarOverlay) {
                    menuToggle.addEventListener('click', function() {
                        sidebar.classList.toggle('active');
                        sidebarOverlay.classList.toggle('active');
                    });

                    sidebarOverlay.addEventListener('click', function() {
                        sidebar.classList.remove('active');
                        sidebarOverlay.classList.remove('active');
                    });
                }

                // Submenu functionality
                const menuItems = document.querySelectorAll('.nav-item.has-submenu');
                
                menuItems.forEach(item => {
                    const link = item.querySelector('.nav-link');
                    const submenu = item.querySelector('.submenu');
                    
                    if (link && submenu) {
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            
                            // Close other open submenus
                            menuItems.forEach(otherItem => {
                                if (otherItem !== item) {
                                    otherItem.classList.remove('open');
                                }
                            });
                            
                            // Toggle current submenu
                            item.classList.toggle('open');
                        });
                    }
                });

                // Close menu when clicking outside on mobile
                document.addEventListener('click', function(e) {
                    if (window.innerWidth <= 768) {
                        const isClickInside = sidebar.contains(e.target) || menuToggle.contains(e.target);
                        if (!isClickInside) {
                            sidebar.classList.remove('active');
                            sidebarOverlay.classList.remove('active');
                        }
                    }
                });

                // Handle window resize
                window.addEventListener('resize', function() {
                    if (window.innerWidth > 768) {
                        sidebar.classList.remove('active');
                        sidebarOverlay.classList.remove('active');
                    }
                });

                // Initialize submenu heights
                function initializeSubmenuHeights() {
                    menuItems.forEach(item => {
                        const submenu = item.querySelector('.submenu');
                        if (submenu) {
                            if (item.classList.contains('open')) {
                                submenu.style.maxHeight = submenu.scrollHeight + 'px';
                            } else {
                                submenu.style.maxHeight = '0';
                            }
                        }
                    });
                }

                // Call initialization
                initializeSubmenuHeights();
            });
        </script>
    </body>
</html>
